# ansible

### Общее

 - Загрузка проекта

`sudo apt install git`

`git clone --branch master --single-branch https://github.com/Firzen475/ansible.git`

- Доступ к WS

Для успешного выполнения скриптов нужно выполнить 3 условия

1) Сервер или контейнер должен иметь возможность получать билет kerberos из домена

`kinit [USER][@REALM]`

2) Пользователь в файле inventory должен быть локальным администратором [link](https://winitpro.ru/index.php/2019/11/27/gpo-dobavit-v-gruppu-lok-admins/)

3) На всех WS установлен PowerShell 5.0+

4) На всех WS включен WinRM [link](https://winitpro.ru/index.php/2012/01/31/kak-aktivirovat-windows-remote-management-s-pomoshhyu-gruppovoj-politiki/)

### I. Групповая установка 1С

`cd ./1c`

 - Изменение переменных и путей

ansible.windows.win_copy не поддерживает переменные в src и dest, поэтому пути прописываются прямо в playbook

`nano ./install_1c.yml`

В файле inventory добавить ws в группу распростронения и заменить пользователя и пароль локального администратора.

`nano ./inventory`

 - Рекомендации

Устанавливается распакованный архив "Технологическая платформа 1С:Предприятия для Windows". Версия на x64 не тестировалась и не рекомендуется из-за проблем с библиотеками.

Во время очистки удаляются все хэши и списки баз, поэтому рекомендуется создать ссылки на список сетевых баз

`nano ./1cestart.cfg`

Параметр UseHwLicenses=0 задаёт принудительное получение лицензий от сервера. Это нужно если клиенты теряют лицензию через некоторое время после запуска 1с

`nano ./base01.v8i`

Доступностью баз для пользователей или групп пользователей удобно управлять через параметры безопасности (чтение и выполнение)

 - Баги

Устанавливается технологическая платформа с тонким и тольстым клиентом, вес дистрибутива почти 1ГБ. Конечно желательно было бы ставить пользователям Тонкий клиент с весом дистрибутива 100МБ. 

Однако, после установки тонкого клиента ланчер "\1cv8\common\1cestart.exe" не видит установленного тонкого клиента и игнорирует настройки в файлах баз. Можно принудительно создать ярлык Тонкого клиента на всех рабочих столах, но что-то не хочется.



